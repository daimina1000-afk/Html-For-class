<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„è‹±æ–‡å–®å­—å­¸ç¿’èˆ‡æ¸¬é©—ç³»çµ± (èª²å ‚å°ˆæ³¨ç‰ˆ)</title>
    <style>
        /* ==================================== */
        /* ğŸ¨ é«˜ç´šæ„Ÿä»‹é¢ CSS è¨­è¨ˆ */
        /* ==================================== */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 40px 20px;
            background-color: #f0f4f4; 
            color: #333;
            text-align: center;
        }

        h1 {
            color: #2c3e50;
            font-size: 2.5em;
            border-bottom: 3px solid #f9c0c0;
            padding-bottom: 10px;
            display: inline-block;
            margin-bottom: 30px;
        }

        /* ä¸»å®¹å™¨æ¨£å¼ */
        #main-menu, #quiz-container, #game-container, #history-container, #search-area {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            max-width: 900px;
            margin: 20px auto;
            /* é»˜èªéƒ½éš±è—ï¼Œåªé€é JS æ§åˆ¶é¡¯ç¤º */
            display: none; 
        }
        /* ä¸»é¸å–®å®¹å™¨å¿…é ˆåœ¨ JS è¼‰å…¥å‰ä½”ä½ï¼Œæ‰€ä»¥åœ¨æ­¤è™•è¨­ç½®ç‚ºå¡Šç´šé¡¯ç¤ºï¼Œä½† JS onload å¾Œæœƒé‡æ–°ç”± showScreen æ§åˆ¶ */
        #main-menu {
             max-width: 600px;
             /* ç‚ºäº†é˜²æ­¢é–ƒçˆï¼Œé€™è£¡ä»ç„¶è®“å®ƒé¡¯ç¤ºï¼Œä½† JS æœƒé‡æ–°æ§åˆ¶ */
             display: block; 
        }

        h2, h3 {
            color: #34495e;
            border-bottom: 1px dashed #ccc;
            padding-bottom: 10px;
            margin-top: 10px;
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        button {
            padding: 10px 22px;
            font-size: 1.1em;
            background-color: #f39c12; 
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            margin: 8px; 
            font-weight: bold;
        }

        button:hover {
            background-color: #e67e22;
            transform: translateY(-1px);
        }

        /* å°èˆªæŒ‰éˆ•ç¾¤çµ„ */
        #main-menu button {
            display: block;
            width: 80%;
            margin: 15px auto;
            background-color: #3498db;
        }
        #main-menu button:hover {
            background-color: #2980b9;
        }
        
        /* æ¸¬é©—å€å¡Šå’Œè¼¸å…¥ */
        #userAnswer {
            padding: 12px;
            font-size: 1.1em;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            margin-bottom: 15px;
            width: 55%;
            margin-right: 10px;
        }
        #question-area {
            font-size: 1.6em;
            font-weight: bold;
            color: #34495e;
            margin-bottom: 25px;
            min-height: 60px;
            line-height: 1.4;
        }
        #timer-display { color: #c0392b; font-size: 1.2em; margin-bottom: 15px; font-weight: bold; }

        /* ==================================== */
        /* ğŸ•¹ï¸ è©å½™é…å°éŠæˆ² CSS */
        /* ==================================== */
        #matching-game {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
            min-height: 250px;
            max-width: 700px;
            margin: 20px auto;
        }
        .match-card {
            width: 120px;
            height: 60px;
            background-color: #ecf0f1;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            margin: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }
        .match-card:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .selected {
            background-color: #f39c12;
            color: white;
            transform: scale(1.05);
        }
        .matched {
            background-color: #2ecc71;
            color: white;
            pointer-events: none; 
        }
        /* éŠæˆ²æç¤º */
        #game-feedback {
            font-size: 1.1em;
            margin: 15px 0;
            min-height: 20px;
        }
        /* ==================================== */
        /* åˆ—è¡¨/æ­·å²ç´€éŒ„ CSS */
        /* ==================================== */
        #search-area {
            max-width: 900px;
        }
        #searchInput {
            width: 80%;
            padding: 10px;
            font-size: 1em;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
            font-size: 0.9em;
        }
        th, td {
            border: 1px solid #ecf0f1;
            padding: 10px;
            text-align: left;
        }
        thead {
            background-color: #34495e;
            color: #ecf0f1;
        }
    </style>
</head>
<body>

    <h1>ğŸ± è‹±æ–‡è©å½™å­¸ç¿’ç³»çµ± (èª²å ‚å°ˆæ³¨ç‰ˆ) ğŸˆ</h1>
    
    <div id="main-menu">
        <h2>è«‹é¸æ“‡åŠŸèƒ½æ¨¡å¼</h2>
        <button onclick="showScreen('quiz-setup')">ğŸ“ é–‹å§‹æ­£å¼æ¸¬é©—</button>
        <button onclick="showScreen('game')">ğŸ® è©å½™é…å°å°éŠæˆ²</button>
        <button onclick="showScreen('history')">ğŸ“Š æ¸¬é©—æ­·å²ç´€éŒ„ (æ•™å¸«å„€è¡¨æ¿)</button>
        <button onclick="showScreen('search')">ğŸ“š æŸ¥çœ‹æ‰€æœ‰å–®å­—è¡¨</button>
    </div>

    <div id="history-container">
        <h3>ğŸ“Š æ¸¬é©—æ­·å²ç´€éŒ„ (æ•™å¸«å„€è¡¨æ¿)</h3>
         /* âœ¨æç¤ºï¼šé€™äº›æ•¸æ“šå„²å­˜åœ¨æ‚¨ç›®å‰ä½¿ç”¨çš„ç€è¦½å™¨ä¸­ã€‚ */ 
        <table id="history-table">
            <thead>
                <tr>
                    <th>æ¸¬é©—æ¬¡æ•¸</th>
                    <th>é¡Œæ•¸</th>
                    <th>å¾—åˆ†</th>
                    <th>ç™¾åˆ†æ¯”</th>
                    <th>èŠ±è²»æ™‚é–“</th>
                    <th>æ—¥æœŸ</th>
                </tr>
            </thead>
            <tbody id="history-tbody">
                <tr><td colspan="6">è¼‰å…¥ä¸­...</td></tr>
            </tbody>
        </table>
        <button onclick="clearHistory()" style="background-color: #e74c3c; margin-top: 20px;">æ¸…é™¤æ‰€æœ‰ç´€éŒ„</button>
        <button onclick="showScreen('main-menu')" style="background-color: #7f8c8d; margin-top: 20px;">è¿”å›ä¸»é¸å–®</button>
    </div>
    
    <div id="game-container">
        <h2>ğŸ•¹ï¸ è©å½™é…å°å°éŠæˆ² (èª²å ‚äº’å‹•æ¨¡æ“¬)</h2>
        <p style="color: #f39c12;">è«‹é»æ“Šè‹±æ–‡å–®å­—å’Œå°æ‡‰çš„ä¸­æ–‡è©ç¾©ä¾†é…å° (10çµ„)</p>
     
        
        <div id="matching-game">
            <button onclick="startGame()">é–‹å§‹éŠæˆ²</button>
        </div>
        <div id="game-feedback"></div>
        <button onclick="showScreen('main-menu')">è¿”å›ä¸»é¸å–®</button>
    </div>

    <div id="quiz-container">
        <h2 id="quiz-title">ğŸ“ å–®å­—æ¸¬é©—</h2>
        
        <div id="quiz-setup">
             <div id="quiz-session-info">
                æ‚¨å·²å®Œæˆæ¸¬é©—ï¼š<span id="quiz-counter" style="font-weight: bold;">0</span> æ¬¡
            </div>
            <label for="questionCount" style="font-size: 1.1em; margin-right: 10px;">é¸æ“‡é¡Œæ•¸ï¼š</label>
            <select id="questionCount">
                <option value="5">5 é¡Œ</option>
                <option value="10" selected>10 é¡Œ</option>
                <option value="20">20 é¡Œ</option>
            </select>
            <button onclick="initQuiz()" id="start-button">é–‹å§‹æ­£å¼æ¸¬é©—</button>
            <button onclick="showScreen('main-menu')">è¿”å›ä¸»é¸å–®</button>
        </div>

        <div id="quiz-active" style="display:none;">
            <div id="timer-display">è¨ˆæ™‚ï¼š00:00</div>
            <div id="score-display">åˆ†æ•¸ï¼š0 / 0</div>
            
            <div id="question-area">
                <p id="chinese-prompt"></p>
            </div>

            <div>
                <input type="text" id="userAnswer" placeholder="è«‹è¼¸å…¥è‹±æ–‡å–®å­—">
                <button onclick="checkAnswer()">é€å‡ºç­”æ¡ˆ</button>
            </div>
            <div id="feedback"></div>
        </div>

        <div id="quiz-finished" style="display:none;">
            <p id="final-score"></p> 
            <button onclick="startNewQuiz()">å†æ¬¡æ¸¬é©—</button>
            <button onclick="showScreen('search')">æŸ¥çœ‹å–®å­—è¡¨</button>
            <button onclick="showScreen('main-menu')">è¿”å›ä¸»é¸å–®</button>
        </div>
    </div>

    <div id="search-area">
        <h3>ğŸ“š è©å½™åˆ—è¡¨èˆ‡å³æ™‚æœå°‹</h3>
        <input type="text" id="searchInput" onkeyup="filterTable()" placeholder="è¼¸å…¥è‹±æ–‡æˆ–ä¸­æ–‡é—œéµå­—ä¾†æœå°‹..." >

        <table id="vocab-table">
            <thead>
                <tr><th>No.</th><th>English</th><th>Part of Speech</th><th>Chinese</th></tr>
            </thead>
            <tbody>
                </tbody>
        </table>
        <button onclick="showScreen('main-menu')" style="margin-top: 20px;">è¿”å›ä¸»é¸å–®</button>
    </div>

    <script>
        // === JavaScript æ•¸æ“šèˆ‡é‚è¼¯ ===
        const vocabulary = [
            { en: 'a', pos: 'article', ch: 'ä¸€å€‹' }, { en: 'angry', pos: 'adj', ch: 'ç”Ÿæ°£çš„' }, { en: 'apple', pos: 'n', ch: 'è˜‹æœ' },
            { en: 'at', pos: 'prep', ch: 'åœ¨' }, { en: 'bag', pos: 'n', ch: 'è¢‹å­' }, { en: 'banana', pos: 'n', ch: 'é¦™è•‰' },
            { en: 'be', pos: 'v', ch: 'æ˜¯' }, { en: 'bed', pos: 'n', ch: 'åºŠ' }, { en: 'bike', pos: 'n', ch: 'è…³è¸è»Š' },
            { en: 'big', pos: 'adj', ch: 'å¤§çš„' }, { en: 'bird', pos: 'n', ch: 'é³¥' }, { en: 'blue', pos: 'adj', ch: 'è—è‰²çš„' },
            { en: 'book', pos: 'n', ch: 'æ›¸æœ¬' }, { en: 'box', pos: 'n', ch: 'ç®±å­' }, { en: 'boy', pos: 'n', ch: 'ç”·å­©' },
            { en: 'bus', pos: 'n', ch: 'å…¬è»Š' }, { en: 'by', pos: 'prep', ch: 'ç¶“ç”±/æ—é‚Š' }, { en: 'cake', pos: 'n', ch: 'è›‹ç³•' },
            { en: 'can', pos: 'v', ch: 'èƒ½/æœƒ' }, { en: 'car', pos: 'n', ch: 'æ±½è»Š' }, { en: 'cat', pos: 'n', ch: 'è²“' },
            { en: 'chair', pos: 'n', ch: 'æ¤…å­' }, { en: 'cola', pos: 'n', ch: 'å¯æ¨‚' }, { en: 'cook', pos: 'v/n', ch: 'ç…®/å»šå¸«' },
            { en: 'dance', pos: 'v', ch: 'è·³èˆ' }, { en: 'desk', pos: 'n', ch: 'æ›¸æ¡Œ' }, { en: 'do', pos: 'v/aux', ch: 'åš' },
            { en: 'doctor', pos: 'n', ch: 'é†«ç”Ÿ' }, { en: 'dog', pos: 'n', ch: 'ç‹—' }, { en: 'draw', pos: 'v', ch: 'ç•«' },
            { en: 'drink', pos: 'v', ch: 'å–' }, { en: 'eat', pos: 'v', ch: 'åƒ' }, { en: 'egg', pos: 'n', ch: 'è›‹' },
            { en: 'eight', pos: 'n', ch: 'å…«' }, { en: 'eraser', pos: 'n', ch: 'æ©¡çš®æ“¦' }, { en: 'fish', pos: 'n', ch: 'é­š' },
            { en: 'five', pos: 'n', ch: 'äº”' }, { en: 'four', pos: 'n', ch: 'å››' }, { en: 'girl', pos: 'n', ch: 'å¥³å­©' },
            { en: 'go', pos: 'v', ch: 'å»' }, { en: 'good', pos: 'adj', ch: 'å¥½çš„' }, { en: 'green', pos: 'adj', ch: 'ç¶ è‰²çš„' },
            { en: 'happy', pos: 'adj', ch: 'å¿«æ¨‚çš„' }, { en: 'he', pos: 'pron', ch: 'ä»–' }, { en: 'home', pos: 'n', ch: 'å®¶' },
            { en: 'hot dog', pos: 'n', ch: 'ç†±ç‹—' }, { en: 'I', pos: 'pron', ch: 'æˆ‘' }, { en: 'in', pos: 'prep', ch: 'åœ¨â€¦ä¹‹å…§' },
            { en: 'it', pos: 'pron', ch: 'å®ƒ' }, { en: 'juice', pos: 'n', ch: 'æœæ±' }, { en: 'jump', pos: 'v', ch: 'è·³' },
            { en: 'key', pos: 'n', ch: 'é‘°åŒ™' }, { en: 'leg', pos: 'n', ch: 'è…¿' }, { en: 'like', pos: 'v', ch: 'å–œæ­¡' },
            { en: 'lion', pos: 'n', ch: 'ç…å­' }, { en: 'marker', pos: 'n', ch: 'é¦¬å…‹ç­†' }, { en: 'milk', pos: 'n', ch: 'ç‰›å¥¶' },
            { en: 'monkey', pos: 'n', ch: 'çŒ´å­' }, { en: 'name', pos: 'n', ch: 'åå­—' }, { en: 'nine', pos: 'n', ch: 'ä¹' },
            { en: 'no', pos: 'adj', ch: 'æ²’æœ‰' }, { en: 'not', pos: 'adv', ch: 'ä¸' }, { en: 'on', pos: 'prep', ch: 'åœ¨â€¦ä¸Šé¢' },
            { en: 'one', pos: 'n', ch: 'ä¸€' }, { en: 'park', pos: 'n/v', ch: 'å…¬åœ’/åœè»Š' }, { en: 'pen', pos: 'n', ch: 'åŸå­ç­†' },
            { en: 'pencil', pos: 'n', ch: 'é‰›ç­†' }, { en: 'pig', pos: 'n', ch: 'è±¬' }, { en: 'pizza', pos: 'n', ch: 'æŠ«è–©' },
            { en: 'rabbit', pos: 'n', ch: 'å…”å­' }, { en: 'read', pos: 'v', ch: 'é–±è®€' }, { en: 'red', pos: 'adj', ch: 'ç´…è‰²çš„' },
            { en: 'ruler', pos: 'n', ch: 'å°º' }, { en: 'run', pos: 'v', ch: 'è·‘' }, { en: 'sad', pos: 'adj', ch: 'é›£éçš„' },
            { en: 'see', pos: 'v', ch: 'çœ‹è¦‹' }, { en: 'seven', pos: 'n', ch: 'ä¸ƒ' }, { en: 'she', pos: 'pron', ch: 'å¥¹' },
            { en: 'short', pos: 'adj', ch: 'çŸ®çš„/çŸ­çš„' }, { en: 'sing', pos: 'v', ch: 'å”±æ­Œ' }, { en: 'six', pos: 'n', ch: 'å…­' },
            { en: 'sleep', pos: 'v', ch: 'ç¡è¦º' }, { en: 'small', pos: 'adj', ch: 'å°çš„' }, { en: 'swim', pos: 'v', ch: 'æ¸¸æ³³' },
            { en: 'table', pos: 'n', ch: 'æ¡Œå­' }, { en: 'tall', pos: 'adj', ch: 'é«˜çš„' }, { en: 'tea', pos: 'n', ch: 'èŒ¶' },
            { en: 'ten', pos: 'n', ch: 'å' }, { en: 'the', pos: 'article', ch: 'é€™' }, { en: 'they', pos: 'pron', ch: 'ä»–å€‘' },
            { en: 'three', pos: 'n', ch: 'ä¸‰' }, { en: 'tiger', pos: 'n', ch: 'è€è™' }, { en: 'train', pos: 'n', ch: 'ç«è»Š' },
            { en: 'two', pos: 'n', ch: 'äºŒ' }, { en: 'water', pos: 'n', ch: 'æ°´' }, { en: 'we', pos: 'pron', ch: 'æˆ‘å€‘' },
            { en: 'write', pos: 'v', ch: 'å¯«' }, { en: 'yes', pos: 'adv', ch: 'æ˜¯' }, { en: 'you', pos: 'pron', ch: 'ä½ /ä½ å€‘' },
            { en: 'zoo', pos: 'n', ch: 'å‹•ç‰©åœ’' }
        ];

        // --- è®Šæ•¸å®šç¾© ---
        let quizWords = []; 
        let currentQuestion = 0;
        let correctCount = 0; 
        let TOTAL_QUESTIONS = 10; 
        let quizCount = 0;
        let timerInterval = null;
        let startTime = null;
        const HISTORY_KEY = 'quiz_history'; 

        // --- éŠæˆ²è®Šæ•¸ ---
        let selectedCards = [];
        let matchedCount = 0;
        const GAME_TOTAL_PAIRS = 10; 

        // ä»‹é¢å…ƒç´ æ˜ å°„
        const SCREENS = {
            'main-menu': document.getElementById('main-menu'),
            'quiz-setup': document.getElementById('quiz-container'), // setup and active are inside
            'game': document.getElementById('game-container'),
            'history': document.getElementById('history-container'),
            'search': document.getElementById('search-area')
        };
        const quizSetup = document.getElementById('quiz-setup');
        const quizActive = document.getElementById('quiz-active');
        const quizFinished = document.getElementById('quiz-finished');
        const historyTbody = document.getElementById('history-tbody');
        const matchingGameDiv = document.getElementById('matching-game');
        const gameFeedbackDiv = document.getElementById('game-feedback');
        const quizCounterElement = document.getElementById('quiz-counter');
        const timerDisplayElement = document.getElementById('timer-display');
        const promptElement = document.getElementById('chinese-prompt');
        const inputElement = document.getElementById('userAnswer');
        const checkButton = document.getElementById('quiz-active').querySelector('button[onclick="checkAnswer()"]');
        const finalScoreElement = document.getElementById('final-score');
        const scoreElement = document.getElementById('score-display');
        const feedbackElement = document.getElementById('feedback');
        
        
        // ====================================
        // ğŸ–¥ï¸ ä»‹é¢åˆ‡æ›èˆ‡å°èˆª (æ ¸å¿ƒåŠŸèƒ½)
        // ====================================

        /**
         * é¡¯ç¤ºæŒ‡å®šçš„ç•«é¢ä¸¦éš±è—å…¶ä»–æ‰€æœ‰ä¸»è¦å€å¡Šã€‚
         * @param {string} screenId - è¦é¡¯ç¤ºçš„å€å¡Š ID (e.g., 'main-menu', 'quiz-setup', 'search')
         */
        function showScreen(screenId) {
            // éæ­·æ‰€æœ‰è¢å¹•ï¼Œå…¨éƒ¨éš±è—
            Object.values(SCREENS).forEach(el => el.style.display = 'none');

            // é¡¯ç¤ºæŒ‡å®šè¢å¹•
            if (SCREENS[screenId]) {
                SCREENS[screenId].style.display = 'block';
                window.scrollTo({ top: 0, behavior: 'smooth' }); // æ²å‹•åˆ°é ‚éƒ¨

                // ç‰¹æ®Šè™•ç†ï¼šç•¶é€²å…¥æ¸¬é©—è¨­ç½®æ™‚ï¼Œç¢ºä¿é¡¯ç¤ºè¨­ç½®å€
                if (screenId === 'quiz-setup') {
                    // Quiz container is the parent, show it first
                    document.getElementById('quiz-container').style.display = 'block'; 
                    quizSetup.style.display = 'block';
                    quizActive.style.display = 'none';
                    quizFinished.style.display = 'none';
                }
                
                // ç‰¹æ®Šè™•ç†ï¼šç•¶é€²å…¥æ­·å²ç´€éŒ„æ™‚ï¼Œè¼‰å…¥æ•¸æ“š
                if (screenId === 'history') {
                    loadHistory();
                }

                // ç‰¹æ®Šè™•ç†ï¼šç•¶é€²å…¥éŠæˆ²æ™‚ï¼Œé‡è¨­éŠæˆ²
                if (screenId === 'game') {
                    matchingGameDiv.innerHTML = '<button onclick="startGame()">é–‹å§‹éŠæˆ²</button>';
                    gameFeedbackDiv.textContent = '';
                }
            }
        }
        
        // ====================================
        // ğŸ› ï¸ é€šç”¨å·¥å…·èˆ‡è¨ˆæ™‚
        // ====================================

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function updateTimer() {
            const elapsed = Date.now() - startTime;
            const totalSeconds = Math.floor(elapsed / 1000);
            const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, '0');
            const seconds = String(totalSeconds % 60).padStart(2, '0');
            timerDisplayElement.textContent = `è¨ˆæ™‚ï¼š${minutes}:${seconds}`;
        }
        
        function formatTime(seconds) {
            const minutes = String(Math.floor(seconds / 60)).padStart(2, '0');
            const remainingSeconds = String(seconds % 60).padStart(2, '0');
            return `${minutes}:${remainingSeconds}`;
        }

        // ====================================
        // ğŸ“Š æ­·å²ç´€éŒ„/æ•™å¸«å„€è¡¨æ¿åŠŸèƒ½
        // ====================================

        function loadHistory() {
            const history = JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];
            historyTbody.innerHTML = '';

            if (history.length === 0) {
                historyTbody.innerHTML = '<tr><td colspan="6">å°šç„¡æ¸¬é©—ç´€éŒ„ã€‚</td></tr>';
                return;
            }

            history.forEach((record, index) => {
                const row = historyTbody.insertRow();
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${record.totalQuestions}</td>
                    <td>${record.correctCount} / ${record.totalQuestions}</td>
                    <td>${Math.round((record.correctCount / record.totalQuestions) * 100)}%</td>
                    <td>${record.timeTaken}</td>
                    <td>${record.date}</td>
                `;
            });
            quizCount = history.length;
            quizCounterElement.textContent = quizCount;
        }

        function saveResult(totalQuestions, correctCount, timeTaken) {
            const history = JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];
            
            const date = new Date().toLocaleDateString('zh-TW', {
                month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit'
            });

            const newRecord = {
                totalQuestions,
                correctCount,
                timeTaken,
                date
            };

            history.push(newRecord);
            localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
            console.log(`[æ•™å¸«æ—¥èªŒ] æ¸¬é©—å·²çµæŸä¸¦å„²å­˜çµæœï¼šé¡Œæ•¸=${totalQuestions}, ç­”å°=${correctCount}, æ™‚é–“=${timeTaken}`);
        }

        function clearHistory() {
            if (confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ¸¬é©—ç´€éŒ„å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•æ¢å¾©ã€‚")) {
                localStorage.removeItem(HISTORY_KEY);
                alert("æ¸¬é©—ç´€éŒ„å·²æ¸…é™¤ã€‚");
                loadHistory();
            }
        }
        
        // ====================================
        // ğŸ“ æ­£å¼æ¸¬é©—åŠŸèƒ½
        // ====================================

        function loadNewQuestion() {
            if (currentQuestion < TOTAL_QUESTIONS) {
                const word = quizWords[currentQuestion];
                promptElement.innerHTML = `ç¬¬ ${currentQuestion + 1} é¡Œï¼šè«‹è¼¸å…¥${word.ch} (${word.pos}) çš„è‹±æ–‡å–®å­—`;
                inputElement.value = '';
                inputElement.focus();
                checkButton.disabled = false;
                feedbackElement.textContent = '';
                console.log(`[æ•™å¸«æ—¥èªŒ] æ¸¬é©—é€²è¡Œä¸­: é¡Œç›® ${currentQuestion + 1}/${TOTAL_QUESTIONS}`);
            } else {
                // *** æ¸¬é©—çµæŸé‚è¼¯ ***
                clearInterval(timerInterval); 
                const elapsedSeconds = Math.floor((Date.now() - startTime) / 1000);
                const finalTime = formatTime(elapsedSeconds);
                
                saveResult(TOTAL_QUESTIONS, correctCount, finalTime);

                quizActive.style.display = 'none';
                quizFinished.style.display = 'block';
                
                const percentage = Math.round((correctCount / TOTAL_QUESTIONS) * 100);
                let feedbackMessage = percentage === 100 ? "è¶…ç´šæ£’ï¼ğŸ‰ğŸ‰ğŸ‰" : (percentage >= 50 ? "å·²ç¶“ç­”å°ä¸€åŠï¼ğŸ’ª ç¹¼çºŒåŠ æ²¹ï¼" : "ç¹¼çºŒåŠªåŠ›ï¼Œä¸‹æ¬¡æœƒæ›´å¥½ï¼");

                finalScoreElement.innerHTML = `
                    <span style="color: #c0392b; font-size: 1.8em; font-weight: bold;">${feedbackMessage}</span>
                    <br>ç¸½é¡Œæ•¸ï¼š${TOTAL_QUESTIONS}ï¼Œç­”å°ï¼š${correctCount} é¡Œ (${percentage}%)<br>
                    èŠ±è²»æ™‚é–“ï¼š${finalTime}
                `;
            }
        }

        function checkAnswer() {
            if (currentQuestion >= TOTAL_QUESTIONS) return;

            const userInput = inputElement.value.trim().toLowerCase();
            const correctWord = quizWords[currentQuestion].en.toLowerCase();
            
            checkButton.disabled = true;

            const result = userInput === correctWord;
            if (result) {
                correctCount++;
                feedbackElement.innerHTML = `<span style="color: green;">âœ” ç­”å°äº†ï¼</span>`;
            } else {
                feedbackElement.innerHTML = `<span style="color: red;">âœ˜ ç­”éŒ¯äº†ã€‚æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š${quizWords[currentQuestion].en}</span>`;
            }
            console.log(`[æ•™å¸«æ—¥èªŒ] é¡Œç›® ${currentQuestion + 1}ï¼šè¼¸å…¥ç­”æ¡ˆ "${userInput}"ï¼Œçµæœ: ${result ? 'æ­£ç¢º' : 'éŒ¯èª¤'}`);


            scoreElement.textContent = `åˆ†æ•¸ï¼š${correctCount} / ${currentQuestion + 1}`;
            
            currentQuestion++;
            setTimeout(loadNewQuestion, 1500); 
        }

        function initQuiz() {
            console.clear(); // æ¸…ç©º Consoleï¼Œé–‹å§‹æ–°çš„æ¸¬é©—æ—¥èªŒ
            
            // 1. è¿½è¹¤æ¸¬é©—æ¬¡æ•¸
            quizCount++;
            quizCounterElement.textContent = quizCount;

            // 2. å•Ÿå‹•è¨ˆæ™‚å™¨
            if (timerInterval) clearInterval(timerInterval);
            timerDisplayElement.textContent = `è¨ˆæ™‚ï¼š00:00`;
            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);

            // 3. æº–å‚™é¡Œç›®
            TOTAL_QUESTIONS = parseInt(document.getElementById('questionCount').value);
            currentQuestion = 0;
            correctCount = 0;
            
            const shuffledVocab = shuffle([...vocabulary]);
            
            // å®‰å…¨æª¢æŸ¥ï¼šé¡Œæ•¸ä¸è¶…éè©å½™ç¸½é‡
            if (TOTAL_QUESTIONS > vocabulary.length) { 
                 TOTAL_QUESTIONS = vocabulary.length; 
            }
            quizWords = shuffledVocab.slice(0, TOTAL_QUESTIONS);

            // 4. åˆ‡æ›ä»‹é¢è‡³æ¸¬é©—æ´»å‹•å€ (Quiz Container å·²ç”± showScreen('quiz-setup') é¡¯ç¤º)
            // Note: We intentionally DO NOT call showScreen here to avoid hiding the Quiz Container itself.
            quizSetup.style.display = 'none';
            quizActive.style.display = 'block';
            quizFinished.style.display = 'none';
            scoreElement.textContent = `åˆ†æ•¸ï¼š0 / 0`;
            inputElement.disabled = false;
            
            loadNewQuestion();
        }

        function startNewQuiz() {
            // æ¸¬é©—çµæŸå¾Œï¼Œè¿”å›è¨­å®šä»‹é¢ (ç”± showScreen æ§åˆ¶éš±è—å–®å­—è¡¨)
            showScreen('quiz-setup');
        }

        // ====================================
        // ğŸ•¹ï¸ è©å½™é…å°éŠæˆ²åŠŸèƒ½
        // ====================================

        function startGame() {
            console.clear();
            console.log("[æ•™å¸«æ—¥èªŒ] è©å½™é…å°éŠæˆ²é–‹å§‹ï¼");

            selectedCards = [];
            matchedCount = 0;
            gameFeedbackDiv.textContent = 'è«‹é¸æ“‡ä¸€å°ä¾†é…å°...';
            
            // éš¨æ©Ÿé¸å– 10 çµ„å–®å­—é€²è¡ŒéŠæˆ²
            const gameWords = shuffle([...vocabulary]).slice(0, GAME_TOTAL_PAIRS);
            
            let cards = [];
            gameWords.forEach(word => {
                cards.push({ id: word.en, type: 'en', text: word.en });
                cards.push({ id: word.en, type: 'ch', text: word.ch });
            });

            cards = shuffle(cards); 

            matchingGameDiv.innerHTML = '';
            cards.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.className = 'match-card';
                cardElement.textContent = card.text;
                cardElement.dataset.id = card.id;
                cardElement.dataset.type = card.type;
                cardElement.onclick = () => handleCardClick(cardElement);
                matchingGameDiv.appendChild(cardElement);
            });
        }

        function handleCardClick(cardElement) {
            if (cardElement.classList.contains('selected') || cardElement.classList.contains('matched') || selectedCards.length === 2) {
                return;
            }

            const cardInfo = cardElement.dataset.id + " (" + cardElement.dataset.type + ")";
            console.log(`[æ•™å¸«æ—¥èªŒ] å­¸ç”Ÿé»æ“Š: ${cardInfo}`);

            cardElement.classList.add('selected');
            selectedCards.push(cardElement);

            if (selectedCards.length === 2) {
                setTimeout(checkMatch, 800);
            }
        }

        function checkMatch() {
            const [card1, card2] = selectedCards;

            if (card1.dataset.id === card2.dataset.id && card1.dataset.type !== card2.dataset.type) {
                // æˆåŠŸé…å°
                card1.classList.remove('selected');
                card2.classList.remove('selected');
                card1.classList.add('matched');
                card2.classList.add('matched');
                gameFeedbackDiv.textContent = 'é…å°æˆåŠŸï¼ğŸ‰';
                matchedCount++;
                console.log(`[æ•™å¸«æ—¥èªŒ] é…å°æˆåŠŸï¼å‰©é¤˜ ${GAME_TOTAL_PAIRS - matchedCount} çµ„`);

                if (matchedCount === GAME_TOTAL_PAIRS) {
                    gameFeedbackDiv.innerHTML = 'âœ¨ æ­å–œå®Œæˆæ‰€æœ‰é…å°ï¼ âœ¨';
                    console.log("[æ•™å¸«æ—¥èªŒ] éŠæˆ²å®Œæˆï¼");
                }
            } else {
                // é…å°å¤±æ•—
                gameFeedbackDiv.textContent = 'é…å°å¤±æ•—ï¼Œè«‹å†è©¦ä¸€æ¬¡ã€‚';
                console.log("[æ•™å¸«æ—¥èªŒ] é…å°å¤±æ•—ï¼Œé‡ç½®å¡ç‰‡ã€‚");
                setTimeout(() => {
                    card1.classList.remove('selected');
                    card2.classList.remove('selected');
                    gameFeedbackDiv.textContent = 'è«‹é¸æ“‡ä¸€å°ä¾†é…å°...';
                }, 500);
            }

            selectedCards = [];
        }


        // ====================================
        // ğŸ“š åˆ—è¡¨èˆ‡æœå°‹åŠŸèƒ½ (è©å½™è¡¨)
        // ====================================

        function generateTable() {
            const tbody = document.querySelector('#vocab-table tbody');
            let html = '';
            vocabulary.forEach((word, index) => {
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${word.en}</td>
                        <td>${word.pos}</td>
                        <td>${word.ch}</td>
                    </tr>
                `;
            });
            tbody.innerHTML = html;
        }

        function filterTable() {
            const input = document.getElementById('searchInput');
            const filter = input.value.toUpperCase().trim();
            const table = document.getElementById('vocab-table');
            const tr = table.getElementsByTagName('tr');

            for (let i = 1; i < tr.length; i++) {
                const tdEnglish = tr[i].getElementsByTagName("td")[1]; 
                const tdChinese = tr[i].getElementsByTagName("td")[3];
                
                if (tdEnglish && tdChinese) {
                    const englishText = tdEnglish.textContent || tdEnglish.innerText;
                    const chineseText = tdChinese.textContent || tdChinese.innerText;

                    if (englishText.toUpperCase().indexOf(filter) > -1 || chineseText.indexOf(filter) > -1) {
                        tr[i].style.display = ""; 
                    } else {
                        tr[i].style.display = "none";
                    }
                }       
            }
        }


        // --- é é¢å•Ÿå‹• ---
        window.onload = function() {
            generateTable(); // ç”Ÿæˆå–®å­—è¡¨
            loadHistory(); // è¼‰å…¥æ­·å²ç´€éŒ„ï¼Œæ›´æ–°æ¬¡æ•¸
            
            // åˆå§‹é¡¯ç¤ºä¸»é¸å–®ï¼Œä¸¦ç¢ºä¿æ‰€æœ‰å…¶ä»–å€å¡Šï¼ˆåŒ…æ‹¬å–®å­—è¡¨ï¼‰éš±è—
            showScreen('main-menu'); 
            
            // ç›£è½ Enter éµ (åƒ…åœ¨æ¸¬é©—é€²è¡Œä¸­æ™‚æœ‰æ•ˆ)
            inputElement.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && quizActive.style.display !== 'none') {
                    checkAnswer();
                }
            });
        };

    </script>
</body>

</html>






